{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞{% endblock %}

{% block styles %}
    <!-- Desktop First -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/director/director_desktop.css') }}">
    
    <!-- Tablet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/director/director_tablet.css') }}" 
          media="screen and (max-width: 1024px)">
    
    <!-- Mobile -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/director/director_mobile.css') }}" 
          media="screen and (max-width: 768px)">
{% endblock %}

{% block content %}
    <div class="header">
        <h1>–ü–∞–Ω–µ–ª—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞</h1>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ name }}!</p>
    </div>
    
    <div class="section">
        <h2>üë• –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–≥–æ–¥–Ω—è ({{ today_key }})</h2>
        {% if today_work %}
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                        <th>–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã</th>
                        <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
                        <th>–†–µ–∞–ª—å–Ω–æ–µ –Ω–∞—á–∞–ª–æ</th>
                        <th>–†–µ–∞–ª—å–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ</th>
                        <th>–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for username, data in today_work.items() %}
                    <tr class="{% if data.status == 'working' %}working{% elif data.status == 'completed' %}completed{% else %}not-started{% endif %}">
                        <td>{{ data.employee_name }} ({{ username }})</td>
                        <td>
                            {{ data.start_time }}
                            {% if data.edited %}
                                <br><small class="edited-badge">‚úèÔ∏è —Ä–µ–¥–∞–∫—Ç.</small>
                            {% endif %}
                        </td>
                        <td>
                            {{ data.end_time or '--:--' }}
                            {% if data.edited and data.end_time %}
                                <br><small class="edited-badge">‚úèÔ∏è —Ä–µ–¥–∞–∫—Ç.</small>
                            {% endif %}
                        </td>
                        <td class="actual-time">{{ data.actual_start_time or '--:--' }}</td>
                        <td class="actual-time">{{ data.actual_end_time or '--:--' }}</td>
                        <td>{{ data.total_hours or '0' }}</td>
                        <td class="description-cell" title="{{ data.description or '' }}">
                            {{ data.description|truncate(50) if data.description else '‚Äî' }}
                        </td>
                        <td>
                            {% if data.status == 'working' %}
                                üü¢ –†–∞–±–æ—Ç–∞–µ—Ç
                            {% elif data.status == 'completed' %}
                                üî¥ –ó–∞–≤–µ—Ä—à–∏–ª
                            {% else %}
                                ‚ö™ –ù–µ —Ä–∞–±–æ—Ç–∞–ª
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">–°–µ–≥–æ–¥–Ω—è –Ω–∏–∫—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª</p>
        {% endif %}
    </div>
    
    <div class="section">
        <h2>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        {% if total_stats %}
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                        <th>–í—Å–µ–≥–æ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</th>
                        <th>–í—Å–µ–≥–æ —á–∞—Å–æ–≤</th>
                        <th>–°—Ä–µ–¥–Ω–µ–µ –≤ –¥–µ–Ω—å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for username, stats in total_stats.items() %}
                    <tr>
                        <td>{{ stats.name }} ({{ username }})</td>
                        <td>{{ stats.work_days }}</td>
                        <td>{{ stats.total_hours }}</td>
                        <td>
                            {% if stats.work_days > 0 %}
                                {{ "%.2f"|format(stats.total_hours / stats.work_days) }}
                            {% else %}
                                0
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞–±–æ—á–µ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        {% endif %}
    </div>
    
    <div class="section">
        <h2>üïí –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–π –≤—Ä–µ–º–µ–Ω–∏</h2>
        {% if edit_history %}
        <div class="table-container">
            <table class="data-table edit-history-table">
                <thead>
                    <tr>
                        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</th>
                        <th>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</th>
                        <th>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</th>
                        <th>–ö–æ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª</th>
                        <th>–ß–∞—Å–æ–≤</th>
                    </tr>
                </thead>
                <tbody>
                    {% for edit in edit_history %}
                    <tr class="edit-row">
                        <td>{{ edit.employee_name }} ({{ edit.username }})</td>
                        <td>{{ edit.date }}</td>
                        <td>
                            <strong>{{ edit.current_start }} - {{ edit.current_end }}</strong>
                        </td>
                        <td class="original-time">
                            {{ edit.original_start }} - {{ edit.original_end }}
                        </td>
                        <td class="actual-time">
                            {{ edit.actual_start }} - {{ edit.actual_end }}
                        </td>
                        <td class="edit-time">
                            –ù–∞—á–∞–ª–æ: {{ edit.edited_start_time }}<br>
                            –û–∫–æ–Ω—á–∞–Ω–∏–µ: {{ edit.edited_end_time }}
                        </td>
                        <td>{{ edit.total_hours }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–π</p>
        {% endif %}
    </div>
    
    <div class="logout">
        <a href="{{ url_for('auth.logout') }}">–í—ã–π—Ç–∏</a>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/director.js') }}"></script>
{% endblock %}