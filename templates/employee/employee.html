{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞{% endblock %}

{% block styles %}
    <!-- Desktop First -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/employee/employee_desktop.css') }}">
    
    <!-- Tablet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/employee/employee_tablet.css') }}" 
          media="screen and (max-width: 1024px)">
    
    <!-- Mobile -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/employee/employee_mobile.css') }}" 
          media="screen and (max-width: 768px)">
{% endblock %}

{% block content %}
    <div class="header">
        <h1>–ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h1>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ name }}!</p>
    </div>
    
    <div class="time-tracker">
        <h2>üìä –£—á—ë—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</h2>
        <div class="status" id="status">
            {% if today_data.status == 'working' %}
                <span class="working">üü¢ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –Ω–∞—á–∞—Ç –≤ {{ today_data.start_time }}</span>
            {% elif today_data.status == 'completed' %}
                <span class="completed">üî¥ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω</span>
            {% else %}
                <span class="not-started">‚ö™ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –Ω–µ –Ω–∞—á–∞—Ç</span>
            {% endif %}
        </div>
        
        <div class="button-group">
            <button class="btn btn-start" id="startBtn" 
                    {% if today_data.status == 'working' or today_data.status == 'completed' %}disabled{% endif %}>
                –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
            </button>
            <button class="btn btn-end" id="endBtn" 
                    {% if today_data.status != 'working' %}disabled{% endif %}>
                –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
            </button>
        </div>
        
        {% if today_data %}
        <div class="time-info">
            <p><strong>–ù–∞—á–∞–ª–æ:</strong> <span id="startTime">{{ today_data.start_time or '--:--' }}</span></p>
            <p><strong>–û–∫–æ–Ω—á–∞–Ω–∏–µ:</strong> <span id="endTime">{{ today_data.end_time or '--:--' }}</span></p>
            <p><strong>–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤:</strong> <span id="totalHours">{{ today_data.total_hours or '0' }}</span></p>
        </div>
        {% endif %}
        
        <!-- –§–æ—Ä–º–∞ –æ–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã -->
        <div class="description-form" id="descriptionForm">
            <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∑–∞ –¥–µ–Ω—å</h3>
            <form id="descriptionFormElement">
                <input type="hidden" name="date" value="{{ today_key }}">
                <div class="form-group">
                    <label for="description">–ß–µ–º –∑–∞–Ω–∏–º–∞–ª–∏—Å—å:</label>
                    <textarea id="description" name="description" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á–∏ –∏ —Ä–∞–±–æ—Ç—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã–ø–æ–ª–Ω—è–ª–∏ —Å–µ–≥–æ–¥–Ω—è...">{{ today_data.description or '' }}</textarea>
                </div>
                <button type="submit" class="btn btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ</button>
            </form>
            <div id="descriptionResult" class="result-message"></div>
            
            {% if today_data.description %}
            <div class="description-preview">
                <strong>–¢–µ–∫—É—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</strong><br>
                {{ today_data.description }}
            </div>
            {% endif %}
        </div>
        
        <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ -->
    <div class="edit-form {% if today_data.status != 'completed' %}hidden{% endif %}" id="editForm">
        <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è</h3>
        <form id="editTimeForm">
            <input type="hidden" name="date" value="{{ today_key }}">
            <div class="form-group">
                <label for="start_time">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                <input type="time" id="start_time" name="start_time" value="{{ today_data.start_time or '09:00' }}" required>
            </div>
            <div class="form-group">
                <label for="end_time">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                <input type="time" id="end_time" name="end_time" value="{{ today_data.end_time or '18:00' }}" required>
            </div>
            <div class="form-group">
                <label for="description_edit">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã:</label>
                <textarea id="description_edit" name="description" placeholder="–û–ø–∏—à–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É...">{{ today_data.description or '' }}</textarea>
            </div>
            <button type="submit" class="btn btn-edit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏</button>
        </form>
        <div id="editResult" class="result-message"></div>
    </div>
    
    <div class="history">
        <h2>üìà –ò—Å—Ç–æ—Ä–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h2>
        <div class="table-container">
            <table class="history-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ù–∞—á–∞–ª–æ</th>
                        <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
                        <th>–ß–∞—Å–æ–≤</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for day in history %}
                    <tr>
                        <td>{{ day.date }}</td>
                        <td>{{ day.start_time }}</td>
                        <td>{{ day.end_time }}</td>
                        <td>{{ day.total_hours }}</td>
                        <td>{{ day.status }}</td>
                        <td class="description-table-cell" title="{{ day.description }}">
                            {{ day.description|truncate(50) if day.description else '‚Äî' }}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="logout">
        <a href="{{ url_for('auth.logout') }}">–í—ã–π—Ç–∏</a>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/employee/employee.js') }}"></script>
{% endblock %}